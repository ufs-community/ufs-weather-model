#
#  cpld_control GFSv17 with UGWPv1 test, i.e., GSL orographic drag +
#  version 1 non-stationary GWD, hydrostatic, long forecast
#

export TEST_DESCR="Fully coupled FV3-CCPP-MOM6-CICE-CMEPS system hydrostatic version - C96MX100 - long forecast"

export CNTL_DIR=cpld_control_sfs_180d

export LIST_FILES="sfcf8280.nc \
                   sfcf8640.nc \
                   atmf8280.nc \
                   atmf8640.nc \
                   GFSFLX.GrbF8280 \
                   GFSFLX.GrbF8640 \
                   GFSPRS.GrbF8280 \
                   GFSPRS.Grb8640 \
                   RESTART/20220317.060000.MOM.res.nc" 

export_fv3
export_cpl
export_ugwpv1

export CPLCHM=.false.
export DNATS=0
export MAKE_NH=.false.
export DDDMP=0
export DO_VORT_DAMP=.false.
export HYDROSTATIC=.true.
export HORD_XX=10
export HORD_DP=10
export KORD_XX=12
export KORD_TM=-12
export D_CON=0

export RESTART_N=360
export RESTART_INTERVAL="${RESTART_N} -1"
export OUTPUT_FH='0 8280 8640'
export OUTPUT_GRID="'gaussian_grid'"
export WRITE_DOPOST=.true.
export MOM6_OUTPUT_FREQ=360
export MOM6_OUTPUT_UNITS=days

export FHMAX=8640

export INPES=$INPES_cpl_bmrk
export JNPES=$JNPES_cpl_bmrk
export WRTTASK_PER_GROUP=$WPG_cpl_bmrk

OCN_tasks=$OCN_tasks_cpl_bmrk
ICE_tasks=$ICE_tasks_cpl_bmrk
WAV_tasks=0
export CICE_NPROC=$ICE_tasks
export np2=`expr $CICE_NPROC / 2`
export CICE_BLCKX=`expr $NX_GLB / $np2`
export CICE_BLCKY=`expr $NY_GLB / 2`

# no wave model
export CPLWAV=.false.
export CPLWAV2ATM=.false.
export MOM6_USE_WAVES=False

 #use downscaled warmstarts for ocean and ice
export OCNICE_WARMSTART=.true.
export MOM6_INIT_FROM_Z=False
export MOM6_INIT_UV=file
export MOM6_WARMSTART_FILE=mom6.warmstart.nc
export CICE_ICE_IC=cice.warmstart.nc

export atm_omp_num_threads=$THRD_cpl_bmrk
export med_omp_num_threads=$atm_omp_num_threads
export ocn_omp_num_threads=$OCN_thrds_cpl_bmrk
export ice_omp_num_threads=$ICE_thrds_cpl_bmrk

export MOM6_TOPOEDITS=ufs.topo_edits_011818.nc
export MOM6_ALLOW_LANDMASK_CHANGES=True
export eps_imesh=2.5e-1

export FV3_RUN=cpld_control_run.IN
export CCPP_SUITE=FV3_GFS_v17_coupled_p8_ugwpv1
export FIELD_TABLE=field_table_thompson_noaero_tke_progsigma
export DIAG_TABLE=diag_table_cpld_sfs.IN
export INPUT_NML=global_control.nml.IN

export UFS_CONFIGURE=ufs.configure.s2s_esmf.IN

#GFSv17	settings
export PROGSIGMA=.true.
export IOPT_DIAG=2

WLCLK=240

# component coupling
export DT_ATMOS=600
export DT_INNER=${DT_ATMOS}
export DT_CICE=${DT_ATMOS}
export DT_DYNAM_MOM6=1800
export DT_THERM_MOM6=3600

# ufs.configure
export coupling_interval_slow_sec=${DT_THERM_MOM6}
export coupling_interval_fast_sec=${DT_ATMOS}

export K_SPLIT=2
export N_SPLIT=5

export NUDGE_QV=.false.
export VTDM4=0.05

# HR4 GFSv17 GWD update
export DO_GWD_OPT_PSL=.true.
export DO_GSL_DRAG_SS=.false.

# CICE Output Format
export CICE_RESTART_FORMAT="hdf5"
export CICE_HISTORY_FORMAT="hdf5"
